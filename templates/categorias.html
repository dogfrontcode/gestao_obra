{% extends "base.html" %}
{% block content %}
<section class="grid gap-8 md:grid-cols-[1.1fr_0.9fr]">
  <div class="rounded-2xl border border-slate-800 bg-surface/70 p-6">
    <h1 class="text-xl font-semibold text-slate-100">Nova categoria</h1>
    <p class="mt-1 text-sm text-slate-400">Organize melhor os lançamentos.</p>

    <form method="post" class="mt-6 space-y-4">
      <div>
        <label for="nome" class="mb-1 block text-sm text-slate-300">Nome da categoria</label>
        <input type="text" id="nome" name="nome" placeholder="Ex: Pedreiro" class="w-full rounded-lg border border-slate-700 bg-surface text-slate-100 placeholder-slate-500 focus:border-accent focus:ring-accent" required>
      </div>
      <button type="submit" class="w-full rounded-lg bg-accent px-4 py-3 text-sm font-semibold text-background transition hover:brightness-110">
        Adicionar categoria
      </button>
    </form>
  </div>

  <div class="rounded-2xl border border-slate-800 bg-surface/70 p-6">
    <div class="flex items-center justify-between">
      <h2 class="text-lg font-semibold text-slate-100">Categorias existentes</h2>
      <span class="rounded-full border border-slate-700 px-3 py-1 text-xs text-slate-400">{{ category_records|length }} cadastradas</span>
    </div>

    {% if category_records %}
      <ul class="mt-6 space-y-4">
        {% for categoria in category_records %}
          <li class="rounded-xl border border-slate-800 bg-surface/80 px-4 py-4">
            <div class="flex items-start justify-between gap-3">
              <div>
                <p class="text-sm font-medium text-slate-100">{{ categoria.nome }}</p>
                <p class="text-xs text-slate-500">ID #{{ categoria.id }}</p>
              </div>
              {% if categoria.id != '1' %}
                <form action="{{ url_for('excluir_categoria', category_id=categoria.id) }}" method="post" onsubmit="return confirm('Remover a categoria {{ categoria.nome }}? Lançamentos associados serão realocados para a categoria padrão.')">
                  <button type="submit" class="rounded-lg border border-rose-500/50 px-3 py-1.5 text-xs font-semibold text-rose-300 transition hover:border-rose-400 hover:text-rose-200">
                    Remover
                  </button>
                </form>
              {% else %}
                <span class="rounded-lg border border-slate-700 px-3 py-1.5 text-xs font-semibold text-slate-400">Categoria padrão</span>
              {% endif %}
            </div>

            <details class="mt-4 rounded-lg border border-slate-800 bg-surface px-3 py-3 text-xs text-slate-400">
              <summary class="cursor-pointer text-slate-300 hover:text-accent">Renomear categoria</summary>
              <form action="{{ url_for('renomear_categoria', category_id=categoria.id) }}" method="post" class="mt-3 flex flex-col gap-3 text-sm text-slate-200 sm:flex-row">
                <input type="text" name="nome" value="{{ categoria.nome }}" class="flex-1 rounded-lg border border-slate-700 bg-surface text-slate-100 focus:border-accent focus:ring-accent" required>
                <button type="submit" class="rounded-lg bg-accent px-4 py-2 text-xs font-semibold text-background transition hover:brightness-110">
                  Salvar
                </button>
              </form>
            </details>
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <div class="mt-6 rounded-xl border border-dashed border-slate-700 bg-surface px-4 py-6 text-center text-sm text-slate-500">
        Nenhuma categoria cadastrada ainda.
      </div>
    {% endif %}
  </div>
</section>
{% endblock %}

