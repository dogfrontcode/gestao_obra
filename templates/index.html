{% extends "base.html" %}
{% block content %}
<section class="grid gap-8 md:grid-cols-[1.1fr_0.9fr]">
  <div class="rounded-2xl border border-slate-800 bg-surface/70 p-6 shadow-xl">
    <h1 class="text-xl font-semibold text-slate-100">Novo lançamento</h1>
    <p class="mt-1 text-sm text-slate-400">Registre gastos rapidamente.</p>

    <form action="{{ url_for('adicionar') }}" method="post" class="mt-6 space-y-4">
      <div>
        <label class="mb-1 block text-sm text-slate-300" for="data">Data</label>
        <input type="date" id="data" name="data" class="w-full rounded-lg border border-slate-700 bg-surface text-slate-100 placeholder-slate-500 focus:border-accent focus:ring-accent" required>
      </div>

      <div>
        <label class="mb-1 block text-sm text-slate-300" for="descricao">Descrição</label>
        <input type="text" id="descricao" name="descricao" placeholder="Ex: Compra de tijolos" class="w-full rounded-lg border border-slate-700 bg-surface text-slate-100 placeholder-slate-500 focus:border-accent focus:ring-accent" required>
      </div>

      <div class="grid gap-4 md:grid-cols-2">
        <div>
          <label class="mb-1 block text-sm text-slate-300" for="valor">Valor</label>
          <input type="number" step="0.01" min="0" id="valor" name="valor" placeholder="0.00" class="w-full rounded-lg border border-slate-700 bg-surface text-slate-100 placeholder-slate-500 focus:border-accent focus:ring-accent" required>
        </div>
        <div>
          <label class="mb-1 block text-sm text-slate-300" for="categoria_id">Categoria</label>
          <select id="categoria_id" name="categoria_id" class="w-full rounded-lg border border-slate-700 bg-surface text-slate-100 focus:border-accent focus:ring-accent" required>
            {% for categoria in category_records %}
              <option value="{{ categoria.id }}">{{ categoria.nome }}</option>
            {% endfor %}
          </select>
        </div>
      </div>

      <div>
        <label class="mb-1 block text-sm text-slate-300" for="anotacao">Anotação</label>
        <textarea id="anotacao" name="anotacao" rows="3" placeholder="Detalhes adicionais" class="w-full rounded-lg border border-slate-700 bg-surface text-slate-100 placeholder-slate-500 focus:border-accent focus:ring-accent"></textarea>
      </div>

      <button type="submit" class="w-full rounded-lg bg-accent px-4 py-3 text-sm font-semibold text-background transition hover:brightness-110">
        Salvar lançamento
      </button>
    </form>
  </div>

  <div class="rounded-2xl border border-slate-800 bg-surface/70 p-6 shadow-xl">
    <div class="flex items-center justify-between">
      <div>
        <h2 class="text-lg font-semibold text-slate-100">Últimos lançamentos</h2>
        <p class="mt-1 text-sm text-slate-400">Gerencie os registros mais recentes diretamente daqui.</p>
      </div>
      <span class="rounded-full border border-slate-700 px-3 py-1 text-xs text-slate-400">Máx. 15 itens</span>
    </div>

    {% if expenses %}
      <ul class="mt-6 space-y-4 overflow-y-auto max-h-[32rem] pr-2">
        {% for item in expenses[:15] %}
          <li class="rounded-xl border border-slate-800 bg-surface px-4 py-4">
            <div class="flex items-start justify-between gap-4">
              <div>
                <p class="text-sm font-medium text-slate-100">{{ item.descricao }}</p>
                <p class="mt-1 text-xs text-slate-500">Categoria: {{ item.categoria_nome }} · Data: {{ item.data }}</p>
                <p class="mt-1 text-xs text-slate-500">{{ item.anotacao or "Sem anotação" }}</p>
              </div>
              <div class="text-right">
                <span class="text-sm font-semibold text-emerald-300">R$ {{ item.valor }}</span>
                <p class="mt-1 text-[10px] uppercase tracking-wide text-slate-500">ID #{{ item.id }}</p>
              </div>
            </div>

            <details class="mt-4 rounded-lg border border-slate-800 bg-surface/80 px-4 py-3 text-xs text-slate-400">
              <summary class="cursor-pointer text-slate-300 hover:text-accent">Editar ou remover</summary>
              <div class="mt-3 space-y-4 text-slate-200">
                <form action="{{ url_for('editar_lancamento', expense_id=item.id) }}" method="post" class="grid gap-3 text-sm sm:grid-cols-2">
                  <div class="sm:col-span-1">
                    <label for="data-{{ item.id }}" class="mb-1 block text-xs text-slate-400">Data</label>
                    <input type="date" id="data-{{ item.id }}" name="data" value="{{ item.data }}" class="w-full rounded-lg border border-slate-700 bg-surface text-slate-100 focus:border-accent focus:ring-accent" required>
                  </div>
                  <div class="sm:col-span-1">
                    <label for="valor-{{ item.id }}" class="mb-1 block text-xs text-slate-400">Valor</label>
                    <input type="number" step="0.01" min="0" id="valor-{{ item.id }}" name="valor" value="{{ item.valor }}" class="w-full rounded-lg border border-slate-700 bg-surface text-slate-100 focus:border-accent focus:ring-accent" required>
                  </div>
                  <div class="sm:col-span-2">
                    <label for="descricao-{{ item.id }}" class="mb-1 block text-xs text-slate-400">Descrição</label>
                    <input type="text" id="descricao-{{ item.id }}" name="descricao" value="{{ item.descricao }}" class="w-full rounded-lg border border-slate-700 bg-surface text-slate-100 focus:border-accent focus:ring-accent" required>
                  </div>
                  <div>
                    <label for="categoria-{{ item.id }}" class="mb-1 block text-xs text-slate-400">Categoria</label>
                    <select id="categoria-{{ item.id }}" name="categoria_id" class="w-full rounded-lg border border-slate-700 bg-surface text-slate-100 focus:border-accent focus:ring-accent" required>
                      {% for categoria in category_records %}
                        <option value="{{ categoria.id }}" {% if categoria.id == item.categoria_id %}selected{% endif %}>{{ categoria.nome }}</option>
                      {% endfor %}
                    </select>
                  </div>
                  <div>
                    <label for="anotacao-{{ item.id }}" class="mb-1 block text-xs text-slate-400">Anotação</label>
                    <textarea id="anotacao-{{ item.id }}" name="anotacao" rows="2" class="w-full rounded-lg border border-slate-700 bg-surface text-slate-100 focus:border-accent focus:ring-accent">{{ item.anotacao }}</textarea>
                  </div>
                  <div class="sm:col-span-2 flex flex-wrap gap-3 pt-2">
                    <button type="submit" class="rounded-lg bg-accent px-4 py-2 text-xs font-semibold text-background transition hover:brightness-110">
                      Atualizar lançamento
                    </button>
                  </div>
                </form>
                <form action="{{ url_for('excluir_lancamento', expense_id=item.id) }}" method="post" class="inline-block" onsubmit="return confirm('Deseja remover este lançamento?')">
                  <button type="submit" class="rounded-lg border border-rose-500/50 px-4 py-2 text-xs font-semibold text-rose-300 transition hover:border-rose-400 hover:text-rose-200">
                    Remover lançamento
                  </button>
                </form>
              </div>
            </details>
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <div class="mt-6 rounded-xl border border-dashed border-slate-700 bg-surface px-4 py-6 text-center text-sm text-slate-500">
        Nenhum lançamento cadastrado ainda.
      </div>
    {% endif %}
  </div>
</section>
{% endblock %}

